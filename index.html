<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OSRS Multi-Herb Farming Profit Calculator</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: Arial, sans-serif;
    max-width: 700px;
    margin: 20px auto;
    padding: 20px;
  }
  label {
    display: block;
    margin: 10px 0 5px;
  }
  input[type="number"] {
    width: 100%;
    padding: 8px;
    font-size: 1rem;
    border-radius: 4px;
    border: none;
  }
  input[type="checkbox"] {
    margin-right: 8px;
    transform: scale(1.1);
  }
  .checkbox-label {
    margin-top: 6px;
    user-select: none;
  }
  button {
    margin-top: 20px;
    background-color: #4caf50;
    border: none;
    color: white;
    padding: 12px;
    width: 100%;
    font-size: 1.1rem;
    border-radius: 6px;
    cursor: pointer;
  }
  #results {
    margin-top: 25px;
    background: #222;
    padding: 15px;
    border-radius: 6px;
    font-size: 0.9rem;
    line-height: 1.4;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    padding: 10px 8px;
    border-bottom: 1px solid #444;
    text-align: center;
  }
  th {
    background-color: #333;
  }
</style>
</head>
<body>

<h1>OSRS Multi-Herb Farming Profit Calculator</h1>

<form id="calcForm">

  <label for="patches">Number of farming patches (1–12):</label>
  <input type="number" id="patches" name="patches" value="8" min="1" max="12" required />

  <label for="baseYield">Base herbs per patch (Ranarr):</label>
  <input type="number" id="baseYield" name="baseYield" step="0.1" value="4.4" min="0" required />

  <label class="checkbox-label">
    <input type="checkbox" id="magicSecateurs" />
    Magic Secateurs (+10% yield)
  </label>
  <label class="checkbox-label">
    <input type="checkbox" id="farmingCape" />
    Farming Cape (+5% yield)
  </label>
  <label class="checkbox-label">
    <input type="checkbox" id="faladorDiary" />
    Falador Medium Diary (+10% yield on Falador patch)
  </label>
  <label class="checkbox-label">
    <input type="checkbox" id="catherbyDiaryMed" />
    Catherby Medium Diary (+5% yield on Catherby patch)
  </label>
  <label class="checkbox-label">
    <input type="checkbox" id="catherbyDiaryHard" />
    Catherby Hard Diary (+10% yield on Catherby patch)
  </label>
  <label class="checkbox-label">
    <input type="checkbox" id="catherbyDiaryElite" />
    Catherby Elite Diary (+15% yield on Catherby patch)
  </label>
  <label class="checkbox-label">
    <input type="checkbox" id="kourendDiary" />
    Hard Kourend & Kebos Diary (+5% yield)
  </label>

  <button type="submit">Calculate Profit</button>
</form>

<div id="results"></div>

<script>
  const API_URL = 'https://prices.runescape.wiki/api/v1/osrs/latest';
  const form = document.getElementById('calcForm');
  const resultsDiv = document.getElementById('results');

  // Hardcoded item IDs per herb/potion combo (3-dose potions)
  // Ranarr → Prayer Potion (3-dose)
  // Toadflax → Saradomin Brew (3-dose)
  // Snapdragon → Super Restore (3-dose)
  const HERBS = [
    {
      name: 'Ranarr',
      seedID: 5295,
      herbID: 257,
      secondaryID: 231,     // Snape grass
      potionID: 2434,       // Prayer potion (3-dose)
      baseYield: 4.4
    },
    {
      name: 'Toadflax',
      seedID: 5297,
      herbID: 2998,
      secondaryID: 6693,    // Crushed nest
      potionID: 6685,       // Saradomin brew (3-dose)
      baseYield: 4.3
    },
    {
      name: 'Snapdragon',
      seedID: 5301,
      herbID: 3000,
      secondaryID: 3025,    // Red spider's eggs
      potionID: 3026,       // Super restore (3-dose)
      baseYield: 3.8
    }
  ];

  // Ultracompost item ID fixed
  const ULTRACOMPOST_ID = 21483;

  let livePrices = {};

  async function fetchLivePrices() {
    try {
      const res = await fetch(API_URL);
      const data = await res.json();
      livePrices = data.data || {};
    } catch {
      alert('Failed to fetch live prices. Try refreshing.');
    }
  }

  function getPrice(id) {
    return livePrices[id]?.high || 0;
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    await fetchLivePrices();

    const patches = Number(form.patches.value);

    // Calculate total yield multiplier from all bonuses selected
    let yieldBonus = 0;
    if (form.magicSecateurs.checked) yieldBonus += 0.10;
    if (form.farmingCape.checked) yieldBonus += 0.05;
    if (form.faladorDiary.checked) yieldBonus += 0.10;
    if (form.catherbyDiaryMed.checked) yieldBonus += 0.05;
    if (form.catherbyDiaryHard.checked) yieldBonus += 0.10;
    if (form.catherbyDiaryElite.checked) yieldBonus += 0.15;
    if (form.kourendDiary.checked) yieldBonus += 0.05;

    // Start building results HTML
    let html = `<h2>Results</h2>
      <table>
      <thead>
        <tr>
          <th>Potion</th>
          <th>Total Herbs</th>
          <th>Seed Cost (gp)</th>
          <th>Compost Cost (gp)</th>
          <th>Secondary Cost (gp)</th>
          <th>Vial Cost (gp)</th>
          <th>Revenue (gp)</th>
          <th>Net Profit (gp)</th>
        </tr>
      </thead>
      <tbody>`;

    for (const herb of HERBS) {
      const baseYield = herb.baseYield;
      const totalHerbsPerPatch = baseYield * (1 + yieldBonus);
      const totalHerbs = totalHerbsPerPatch * patches;

      // Prices from API
      const seedPrice = getPrice(herb.seedID);
      const compostPrice = getPrice(ULTRACOMPOST_ID);
      const secondaryPrice = getPrice(herb.secondaryID);
      const vialPrice = getPrice(227); // vial of water fixed ID
      const potionPrice = getPrice(herb.potionID);

      const seedCost = seedPrice * patches;
      const compostCost = compostPrice * patches;
      const secondaryCost = secondaryPrice * totalHerbs;
      const vialCost = vialPrice * totalHerbs;
      const revenue = potionPrice * totalHerbs;

      const profit = revenue - (seedCost + compostCost + secondaryCost + vialCost);

      html += `
      <tr>
        <td>${herb.name} Potion</td>
        <td>${totalHerbs.toFixed(2)}</td>
        <td>${seedCost.toLocaleString()}</td>
        <td>${compostCost.toLocaleString()}</td>
        <td>${secondaryCost.toLocaleString()}</td>
        <td>${vialCost.toLocaleString()}</td>
        <td>${revenue.toLocaleString()}</td>
        <td><strong>${profit.toLocaleString()}</strong></td>
      </tr>`;
    }

    html += '</tbody></table>';
    resultsDiv.innerHTML = html;
  });
</script>

</body>
</html>
