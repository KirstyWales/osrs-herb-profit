<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OSRS Adjusted GP/XP Calculator</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: sans-serif;
      padding: 2rem;
    }
    label, select, input, button {
      display: block;
      margin: 1rem 0;
    }
  </style>
</head>
<body>
  <h1>Herblore GP per XP (Finished Potion vs Grimy Herb)</h1>
  <p><em>Assumes ultracompost and Magic Secateurs, yielding 8.5 herbs per patch.</em></p>

  <label for="herbType">Herb Type:</label>
  <select id="herbType">
    <option value="ranarr">Ranarr</option>
    <option value="snapdragon">Snapdragon</option>
    <option value="toadflax">Toadflax</option>
  </select>

  <label for="patches">Number of Herb Patches:</label>
  <input type="number" id="patches" value="5" min="1" />

  <button onclick="calculateProfit()">Calculate</button>

  <pre id="result"></pre>

  <script>
    const API_URL = "https://prices.runescape.wiki/api/v1/osrs/latest";

    const ids = {
      ranarr: { seed: 5295, herb: 257, secondary: 231, potion: 139 },
      snapdragon: { seed: 5300, herb: 3000, secondary: 223, potion: 3026 },
      toadflax: { seed: 5296, herb: 2998, secondary: 6693, potion: 6687 },
      vial: 227,
      ultracompost: 21483
    };

    async function fetchPrices() {
      const response = await fetch(API_URL);
      const data = await response.json();
      return data.data;
    }

    async function calculateProfit() {
      const herbType = document.getElementById("herbType").value;
      const patches = parseInt(document.getElementById("patches").value);
      const herbsHarvested = patches * 8.5;

      const prices = await fetchPrices();

      const seedCost = prices[ids[herbType].seed].high;
      const compostCost = prices[ids.ultracompost].high;
      const herbPrice = prices[ids[herbType].herb].high;
      const vialCost = prices[ids.vial].high;
      const secondaryCost = prices[ids[herbType].secondary].high;
      const potionPrice = prices[ids[herbType].potion].high;

      // XP per herb type
      const xpPerHerb = {
        ranarr: 7.5 + 87.5,
        snapdragon: 11.8 + 142.5,
        toadflax: 8.0 + 180
      }[herbType];

      const totalXP = herbsHarvested * xpPerHerb;

      // Cost and revenue for finished potion path
      const potionCost =
        (seedCost + compostCost) * patches +
        herbsHarvested * vialCost +
        herbsHarvested * secondaryCost;
      const potionRevenue = herbsHarvested * potionPrice;
      const potionProfit = potionRevenue - potionCost;

      // Cost and revenue for grimy herb path
      const grimyCost = (seedCost + compostCost) * patches;
      const grimyRevenue = herbsHarvested * herbPrice;
      const grimyProfit = grimyRevenue - grimyCost;

      // Extra profit from potion path
      const extraProfit = potionProfit - grimyProfit;
      const adjustedGpPerXp = extraProfit / totalXP;

      document.getElementById("result").textContent = `
---
Herb Type: ${herbType.charAt(0).toUpperCase() + herbType.slice(1)}
Patches: ${patches}
Herbs Harvested: ${herbsHarvested.toFixed(1)}

Finished Potion Profit: ${potionProfit.toLocaleString()} gp
Grimy Herb Profit: ${grimyProfit.toLocaleString()} gp

Herblore XP Gained: ${totalXP.toLocaleString()} xp
Adjusted GP per XP (extra from potions): ${adjustedGpPerXp.toFixed(2)} gp/xp
`;
    }
  </script>
</body>
</html>
