<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>OSRS Herb Farming Profit Calculator</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: Arial, sans-serif;
    max-width: 700px;
    margin: 20px auto;
    padding: 20px;
  }
  label {
    display: block;
    margin: 10px 0 5px;
  }
  input[type="number"], select {
    width: 100%;
    padding: 8px;
    font-size: 1rem;
    border-radius: 4px;
    border: none;
  }
  input[type="checkbox"] {
    margin-right: 8px;
    transform: scale(1.1);
  }
  .checkbox-label {
    margin-top: 6px;
    user-select: none;
  }
  button {
    margin-top: 20px;
    background-color: #4caf50;
    border: none;
    color: white;
    padding: 12px;
    width: 100%;
    font-size: 1.1rem;
    border-radius: 6px;
    cursor: pointer;
  }
  #results {
    margin-top: 25px;
    background: #222;
    padding: 15px;
    border-radius: 6px;
    font-size: 0.9rem;
    line-height: 1.4;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    padding: 10px 8px;
    border-bottom: 1px solid #444;
    text-align: center;
  }
  th {
    background-color: #333;
  }
</style>
</head>
<body>

<h1>OSRS Herb Farming Profit Calculator</h1>

<form id="calcForm">
  <label for="patches">Number of farming patches (1â€“12):</label>
  <input type="number" id="patches" name="patches" value="8" min="1" max="12" required />

  <label for="baseYield">Base herbs per patch (e.g. 4.4 for Ranarr):</label>
  <input type="number" id="baseYield" name="baseYield" step="0.1" value="4.4" min="0" required />

  <label class="checkbox-label">
    <input type="checkbox" id="magicSecateurs" />
    Magic Secateurs (+10% yield)
  </label>
  <label class="checkbox-label">
    <input type="checkbox" id="farmingCape" />
    Farming Cape (+5% yield)
  </label>
  <label class="checkbox-label">
    <input type="checkbox" id="faladorDiary" />
    Falador Medium Diary (+10% yield on Falador patch)
  </label>
  <label class="checkbox-label">
    <input type="checkbox" id="catherbyDiaryMed" />
    Catherby Medium Diary (+5% yield on Catherby patch)
  </label>
  <label class="checkbox-label">
    <input type="checkbox" id="catherbyDiaryHard" />
    Catherby Hard Diary (+10% yield on Catherby patch)
  </label>
  <label class="checkbox-label">
    <input type="checkbox" id="catherbyDiaryElite" />
    Catherby Elite Diary (+15% yield on Catherby patch)
  </label>
  <label class="checkbox-label">
    <input type="checkbox" id="kourendDiary" />
    Hard Kourend & Kebos Diary (+5% yield)
  </label>

  <label for="seedID">Ranarr seed item ID (for price lookup):</label>
  <input type="number" id="seedID" value="5295" required />

  <label for="herbID">Clean Ranarr herb item ID (for price lookup):</label>
  <input type="number" id="herbID" value="257" required />

  <label for="secondaryID">Snape grass item ID (for price lookup):</label>
  <input type="number" id="secondaryID" value="231" required />

  <label for="vialID">Vial of water item ID (for price lookup):</label>
  <input type="number" id="vialID" value="227" required />

  <label for="ultraCompostID">Ultracompost item ID (for price lookup):</label>
  <input type="number" id="ultraCompostID" value="21483" required />

  <label for="potionID">3-dose Prayer potion item ID (for price lookup):</label>
  <input type="number" id="potionID" value="2434" required />

  <button type="submit">Calculate Profit</button>
</form>

<div id="results"></div>

<script>
  const API_URL = 'https://prices.runescape.wiki/api/v1/osrs/latest';
  const form = document.getElementById('calcForm');
  const resultsDiv = document.getElementById('results');

  let livePrices = {};

  async function fetchLivePrices() {
    try {
      const res = await fetch(API_URL);
      const data = await res.json();
      livePrices = data.data || {};
    } catch {
      alert('Failed to fetch live prices. Try refreshing.');
    }
  }

  function getPrice(id) {
    return livePrices[id]?.high || 0;
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    await fetchLivePrices();

    const patches = Number(form.patches.value);
    const baseYield = Number(form.baseYield.value);

    // Sum yield bonuses additively (change if you want multiplicative)
    let yieldBonus = 0;
    if (form.magicSecateurs.checked) yieldBonus += 0.10;
    if (form.farmingCape.checked) yieldBonus += 0.05;
    if (form.faladorDiary.checked) yieldBonus += 0.10;
    if (form.catherbyDiaryMed.checked) yieldBonus += 0.05;
    if (form.catherbyDiaryHard.checked) yieldBonus += 0.10;
    if (form.catherbyDiaryElite.checked) yieldBonus += 0.15;
    if (form.kourendDiary.checked) yieldBonus += 0.05;

    const totalHerbsPerPatch = baseYield * (1 + yieldBonus);

    const seedID = Number(form.seedID.value);
    const herbID = Number(form.herbID.value);
    const secondaryID = Number(form.secondaryID.value);
    const vialID = Number(form.vialID.value);
    const ultraCompostID = Number(form.ultraCompostID.value);
    const potionID = Number(form.potionID.value);

    // Prices
    const seedPrice = getPrice(seedID);
    const herbPrice = getPrice(herbID);
    const secondaryPrice = getPrice(secondaryID);
    const vialPrice = getPrice(vialID);
    const compostPrice = getPrice(ultraCompostID);
    const potionPrice = getPrice(potionID);

    // Costs
    const totalHerbs = totalHerbsPerPatch * patches;

    const seedCost = seedPrice * patches; // per patch
    const compostCost = compostPrice * patches; // per patch
    const secondaryCost = secondaryPrice * totalHerbs; // per herb
    const vialCost = vialPrice * totalHerbs; // per herb

    // Revenue from selling potions (1 herb = 1 potion)
    const revenue = potionPrice * totalHerbs;

    // Profit
    const profit = revenue - (seedCost + compostCost + secondaryCost + vialCost);

    resultsDiv.innerHTML = `
      <h2>Results</h2>
      <table>
        <tr><th>Metric</th><th>Value</th></tr>
        <tr><td>Total Herbs Harvested</td><td>${totalHerbs.toFixed(2)}</td></tr>
        <tr><td>Seed Cost (gp)</td><td>${seedCost.toLocaleString()}</td></tr>
        <tr><td>Compost Cost (gp)</td><td>${compostCost.toLocaleString()}</td></tr>
        <tr><td>Secondary Ingredient Cost (gp)</td><td>${secondaryCost.toLocaleString()}</td></tr>
        <tr><td>Vial Cost (gp)</td><td>${vialCost.toLocaleString()}</td></tr>
        <tr><td>Revenue from Potion Sales (gp)</td><td>${revenue.toLocaleString()}</td></tr>
        <tr><td><strong>Net Profit (gp)</strong></td><td><strong>${profit.toLocaleString()}</strong></td></tr>
      </table>
    `;
  });
</script>

</body>
</html>
