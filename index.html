<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OSRS Potion Profit Calculator</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
    }
    label {
      display: block;
      margin: 10px 0 5px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      font-size: 1rem;
      border-radius: 4px;
      border: none;
    }
    button {
      margin-top: 20px;
      background-color: #4caf50;
      border: none;
      color: white;
      padding: 12px;
      width: 100%;
      font-size: 1.1rem;
      border-radius: 6px;
      cursor: pointer;
    }
    #results {
      margin-top: 25px;
      background: #222;
      padding: 15px;
      border-radius: 6px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px 8px;
      border-bottom: 1px solid #444;
      text-align: center;
    }
    th {
      background-color: #333;
    }
  </style>
</head>
<body>

  <h1>OSRS Potion Profit Calculator</h1>

  <form id="profitForm">
    <label for="patches">Number of farming patches (1â€“12):</label>
    <input type="number" id="patches" name="patches" value="8" min="1" max="12" required />

    <label for="compost">Compost type:</label>
    <select id="compost" name="compost">
      <option value="none">None</option>
      <option value="normal">Compost</option>
      <option value="super">Supercompost</option>
      <option value="ultra" selected>Ultracompost</option>
    </select>

    <label>
      <input type="checkbox" id="secateurs" name="secateurs" checked />
      Using Magic Secateurs (+10% yield)
    </label>

    <button type="submit">Calculate Profit</button>
  </form>

  <div id="results"></div>

  <script>
    const API_URL = 'https://prices.runescape.wiki/api/v1/osrs/latest';
    const BASE_HERBS_PER_PATCH = 7;

    const COMPOST_MULTIPLIERS = {
      none: 1.0,
      normal: 1.1,
      super: 1.15,
      ultra: 1.2
    };

    const COMPOST_IDS = {
      normal: 6032,
      super: 6034,
      ultra: 21483
    };

    const POTIONS = [
  {
    key: 'prayer_potion',
    name: 'Prayer Potion (3-dose)',
    seedID: 5295,
    secondaryID: 231,
    vialID: 227,
    productID: 139       // Correct ID for Prayer potion (3)
  },
  {
    key: 'super_restore',
    name: 'Super Restore (3-dose)',
    seedID: 3049,
    secondaryID: 223,
    vialID: 227,
    productID: 3027     // Correct ID for Super restore (3)
  },
  {
    key: 'saradomin_brew',
    name: 'Saradomin Brew (3-dose)',
    seedID: 5300,
    secondaryID: 6693,
    vialID: 227,
    productID: 6687     // Correct ID for Saradomin brew (3)
  }
];


    let livePrices = {};

    async function fetchLivePrices() {
      try {
        const res = await fetch(API_URL);
        const data = await res.json();
        livePrices = data.data || {};
      } catch (err) {
        alert('Failed to fetch live prices. Try again.');
        console.error(err);
      }
    }

    function getPrice(id) {
      return livePrices[id]?.high || 0;
    }

    function calculatePotionProfit(potion, patches, compostType, secateurs) {
      const compostMultiplier = COMPOST_MULTIPLIERS[compostType] || 1.0;
      const secateursMultiplier = secateurs ? 1.1 : 1.0;

      const totalHerbs = BASE_HERBS_PER_PATCH * compostMultiplier * secateursMultiplier * patches;

      const seedCost = getPrice(potion.seedID);
      const seedCostPerHerb = seedCost / BASE_HERBS_PER_PATCH;
      const totalSeedCost = seedCostPerHerb * totalHerbs;

      const compostCost = compostType === 'none' ? 0 : getPrice(COMPOST_IDS[compostType]) * patches;
      const secondaryCost = getPrice(potion.secondaryID) * totalHerbs;
      const vialCost = getPrice(potion.vialID) * totalHerbs;
      const potionSellPrice = getPrice(potion.productID);
      const revenue = (potionSellPrice / 3) * totalHerbs;

      const netProfit = revenue - (totalSeedCost + compostCost + secondaryCost + vialCost);

      return {
        name: potion.name,
        totalHerbs: totalHerbs.toFixed(1),
        seedCost: totalSeedCost.toFixed(0),
        compostCost: compostCost.toFixed(0),
        secondaryCost: secondaryCost.toFixed(0),
        vialCost: vialCost.toFixed(0),
        revenue: revenue.toFixed(0),
        netProfit: netProfit.toFixed(0),
        potionSellPrice: potionSellPrice
      };
    }

    function renderResults(results) {
      if (!results.length) {
        document.getElementById('results').innerHTML = '<p>No results to show.</p>';
        return;
      }

      let html = `<table>
        <thead>
          <tr>
            <th>Potion</th>
            <th>GE Price</th>
            <th>Total Herbs</th>
            <th>Seed Cost</th>
            <th>Compost Cost</th>
            <th>Secondary Cost</th>
            <th>Vial Cost</th>
            <th>Revenue</th>
            <th>Net Profit</th>
          </tr>
        </thead>
        <tbody>`;

      results.forEach(r => {
        html += `<tr>
          <td>${r.name}</td>
          <td>${r.potionSellPrice.toLocaleString()} gp</td>
          <td>${r.totalHerbs}</td>
          <td>${r.seedCost}</td>
          <td>${r.compostCost}</td>
          <td>${r.secondaryCost}</td>
          <td>${r.vialCost}</td>
          <td>${r.revenue}</td>
          <td style="color: ${r.netProfit >= 0 ? 'lime' : 'red'};">${r.netProfit}</td>
        </tr>`;
      });

      html += '</tbody></table>';
      document.getElementById('results').innerHTML = html;
    }

    async function init() {
      await fetchLivePrices();

      document.getElementById('profitForm').addEventListener('submit', e => {
        e.preventDefault();

        const patches = parseInt(document.getElementById('patches').value);
        const compostType = document.getElementById('compost').value;
        const secateurs = document.getElementById('secateurs').checked;

        const results = POTIONS.map(p => calculatePotionProfit(p, patches, compostType, secateurs));
        renderResults(results);
      });
    }

    init();
  </script>
</body>
</html>
